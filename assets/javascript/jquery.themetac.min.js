/* moozhlTabs */
;(function(){
	jQuery.fn.moozhlTabs = function(options){
		var defaults = {
			navSelector: '.tabs_header',
			contentSelector: '.tabs_content',
			fx: 'fade',
			speed: 500,
			activeClass: 'active',
		};
		var tabbed ,config,fx,navSelector,contentSelector,speed,tabs,activeClass;
		tabbed = this;
		config = jQuery.extend({},defaults, options);
		fx = config.fx;
		navSelector = config.navSelector;
		contentSelector = config.contentSelector;
		speed = config.speed;
		tabs = tabbed.find(navSelector+' ul');
		activeClass = config.activeClass;
		tabs.find('li:first').addClass(activeClass);
		tabbed.find('.tab').hide();
		tabbed.find('.tab:first-child').show();
		tabs.each(function(i) {
			var tabButton = jQuery(this).find('> li > a');
			var tabContent = jQuery(this).parent('div').next(contentSelector);
			tabButton.click(function(e) {
			var activeTabId = jQuery(this).attr('href');
			if(typeof(activeTabId) != 'undefined'){
				e.preventDefault();
				tabButton.parent('li').removeClass(activeClass);
				jQuery(this).parent('li').addClass(activeClass);
				if(fx == 'fade'){
					tabContent.children(activeTabId).fadeIn(speed).siblings().hide();
				}
				if(fx == 'slide'){
					tabContent.children(activeTabId).slideDown(speed).siblings().hide();
				}
			}
			return false;
		});
		});
	}
}(jQuery));
// Object mainSlider options
var mainSliderOptions = {
		namespace: '',
		animationLoop:true,
		slideshow:true,
		slideshowSpeed:6200,
		animationSpeed:800,
		pauseOnHover:true,
		pauseOnAction:true,
		controlNav:true,
		directionNav:true,
		controlsContainer: '#main_slider .slider_controls',
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		slideIn: function(){
			$('.active-slide .fadeTop').each(function(index, element) {
				$ele = $(element);
				eleTop = $ele.attr('data-top');
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleTop = $ele.attr('data-top');
					eleSpeed = $ele.attr('data-speed');
					$ele.stop(true, true).animate({'top':eleTop,'opacity':1},eleSpeed);
				},eleDelay);
			});
			$('.active-slide .fadeBottom').each(function(index, element) {
				$ele = $(element);
				eleBottom = $ele.attr('data-bottom');
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleBottom = $ele.attr('data-bottom');
					eleSpeed = $ele.attr('data-speed');
					$ele.stop(true, true).animate({'bottom':eleBottom,'opacity':1},eleSpeed);
				},eleDelay);
			});
			$('.active-slide .fadeRight').each(function(index, element) {
				$ele = $(element);
				eleDelay = $ele.attr('data-delay');
				eleRight = $ele.attr('data-right');
				setTimeout(function(){
					$ele = $(element);
					eleRight = $ele.attr('data-right');
					eleSpeed = $ele.attr('data-speed');
					$ele.stop(true, true).animate({'right':eleRight,'opacity':1},eleSpeed);
				},eleDelay);
			});
			$('.active-slide .fadeLeft').each(function(index, element) {
				$ele = $(element);
				eleLeft = $ele.attr('data-left');
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleLeft = $ele.attr('data-left');
					eleSpeed = $ele.attr('data-speed');
					$ele.stop(true, true).animate({'left':eleLeft,'opacity':1},eleSpeed);
				},eleDelay);
			});	
		},
		slideOut: function(){
			$('.active-slide .fadeTop').each(function(index, element) {
				$ele = $(element);
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleTop = -($ele.height());
					eleSpeed = $ele.attr('data-speed');
					if (Modernizr.opacity) $ele.stop(true, true).animate({'top':eleTop,'opacity':0},eleSpeed);
				},eleDelay);
			});
			$('.active-slide .fadeBottom').each(function(index, element) {
				$ele = $(element);
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleBottom = -($ele.height());
					eleSpeed = $ele.attr('data-speed');
					if (Modernizr.opacity) $ele.stop(true, true).animate({'bottom':eleBottom,'opacity':0},eleSpeed);
				},eleDelay);
			});	
			$('.active-slide .fadeRight').each(function(index, element) {
				$ele = $(element);
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleRight = '-20%';
					eleSpeed = $ele.attr('data-speed');
					if (Modernizr.opacity) $ele.stop(true, true).animate({'right':eleRight,'opacity':0},eleSpeed);
				},eleDelay);
			});
			$('.active-slide .fadeLeft').each(function(index, element) {
				$ele = $(element);
				eleDelay = $ele.attr('data-delay');
				setTimeout(function(){
					$ele = $(element);
					eleLeft = '-20%';
					eleSpeed = $ele.attr('data-speed');
					if (Modernizr.opacity) $ele.stop(true, true).animate({'left':eleLeft,'opacity':0},eleSpeed);
				},eleDelay);
			});	
		},
		start: function(slider){
			$('#main_slider').css({'background-image':'none'});
			this.slideIn();
		},
		before: function(){
			this.slideOut();
		},
		after: function(){
			this.slideIn();
		}
	}
// Object worksCarousel options
var worksCarousel = {
		namespace: '',
		animation: 'slide',
		controlNav: false,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		itemWidth: 220,
		itemMargin: 20,
		move: 1,
		pauseOnHover: true,
		animationLoop: false,
		minItems: 1,
		maxItems: 3
	}
// Object teamCarousel options
var teamCarousel = {
		namespace: '',
		animation: 'slide',
		controlNav: false,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		itemWidth: 220,
		itemMargin: 20,
		move: 1,
		pauseOnHover: true,
		animationLoop: false,
		minItems: 1,
		maxItems: 4
	}
// Object feedbackSlider options
var feedbackSlider = {
		namespace: '',
		animation: 'fade',
		controlNav: false,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		pauseOnHover: true
	}
// Object partnersSlider options
var partnersSlider = {
		namespace: '',
		animation: 'slide',
		controlNav: false,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		pauseOnHover: true,
		itemWidth: 180,
		itemMargin: 10,
		move: 1,
		minItems: 1,
		maxItems: 5
	}
// Object portfolioSlider options
var portfolioSlider = {
		namespace: '',
		animation: 'slide',
		animationLoop: false,
    	slideshow: false,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		pauseOnHover: true,
		manualControls: ".portfolio_slider .paging span, .portfolio_slider .carousel img",
		controlsContainer: ".portfolio_slider .navigation_row",
		sync: ".portfolio_slider .thumbnails",
		start: function(slider){
			$('.portfolio_slider .slider').css({'background':'none','height':'auto'});
			$('.portfolio_slider li').css({'opacity':1});
		}
	}
// Object portfolioThumbnails options
var portfolioThumbnails = {
		namespace: '',
		animation: 'slide',
		animationLoop: false,
    	slideshow: false,
		controlNav: false,
		directionNav: false,
		itemWidth: 79,
		itemMargin: 2,
		move: 5,
		minItems: 5,
		maxItems: 5,
		asNavFor: '.portfolio_slider .slider'
	}
// Object simpleSlider options
var simpleSlider = {
		namespace: '',
		animation: 'slide',
		controlNav: true,
		directionNav: true,
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		start: function(slider){
			$('.block_simple_slider .slides').css({'background':'none','height':'auto'});
			$('.block_simple_slider li').css({'opacity':1});
		}
	}
// Object postGalleryHead options
var postGalleryHead = {
		namespace: '',
		animation: 'slide',
		controlNav: true,
		directionNav: true,
		controlsContainer: '.post_gallery_head .slider_controls',
		prevText: '<span class="icon_prev"></span>',
		nextText: '<span class="icon_next"></span>',
		start: function(slider){
			$('.post_gallery_head').css({'background':'none','height':'auto'});
			$('.post_gallery_head li').css({'opacity':1});
		}
	}
// Object comingCounter
var comingCounter = {
	targetDate: {
		'year': 2014,
		'month': 12,
		'day': 31,
		'hour': 0,
		'min': 0,
		'sec': 0
	},
	omitWeeks: true
}
// headerLogo
function headerLogo(){
	$('#header_elements_wrap').css({'left':($('#header_logo img').width() + 30)+'px'});
}
// headerSearch
function headerSearch(){
	$('.search_anchor').click(function(e){
		$('.header_res_row .header_search').animate({'height':'20px'},200).addClass('header_search_visible');
		return false;
	});
	$(document).mouseup(function (e){
		var header_res_search = $('.header_search_visible');
		if (!header_res_search.is(e.target) && header_res_search.has(e.target).length === 0){
			header_res_search.animate({'height':'0px'},200);
		}
	});
}
// mainNav
function mainNav(){
	$('.main_res_nav').hide();
	$('#show_res_menu').click(function(e) {
		$(this).toggleClass('active');
		$(this).next('.main_res_nav').slideToggle();
		return false;
	});
	$('.main_res_nav ul li:has(ul)').children('a').after('<span class="drop_icon icon_plus"></span>');
	$('.main_res_nav ul ul').css({'display':'none'});
	$('.main_res_nav ul li:has(ul)').hoverIntent(function(){
		$(this).children('ul').stop().slideDown(400);
		$(this).children('.drop_icon').removeClass('icon_plus').addClass('icon_minus');
	},function(){
		$(this).children('ul').stop().slideUp(260);
		$(this).children('.drop_icon').removeClass('icon_minus').addClass('icon_plus');
	});
	$('.main_nav').superfish({
		delay: 0,
		animation: {height:'show'}
	});
	$('.sf-with-ul').append('<span class="icon_plus"></span>');
}
// newsTicker
function newsTicker(){
	if($.fn.liScroll){
		$('.news_ticker ul').liScroll();
	}
	function ticker_width(){
		var tickerWidth = $('.news_ticker').width(),
			titleWidth = $('.news_ticker .ticker_title').width()+13;
		$('.news_ticker .ticker_content').width(tickerWidth-titleWidth-20);
	};
	ticker_width();
	$(window).resize(function(){
		ticker_width();
	});
}
// blockVisibility
function blockVisibility(){
	$('.block_visibility').click(function(e) {
		if($(this).attr('data-visibility') == 'open'){
			$(this).attr('data-visibility','close').find('span').attr('class','icon_up');
			$(this).parent().next('.block_body').slideUp();
		}else{
			$(this).attr('data-visibility','open').find('span').attr('class','icon_bottom');
			$(this).parent().next('.block_body').slideDown();
		}
		return false;
	});
}
// flexSlider
function flexSliderUsage(ele,op){
	if($.fn.flexslider && ele.length > 0){
		ele.flexslider(op);
	}
}
// accordion
function accordion() {
	$('.accordion > dd').hide();
	$('.accordion > dt:first-child').addClass('active').next().show()
		.end().find('.accordion_icon').removeClass('icon_plus').addClass('icon_minus');
	
	$('.accordion > dt').click(function() {
		if(!$(this).hasClass('active')){
			$('.accordion .active').next().slideUp()
				.end().find('.accordion_icon').removeClass('icon_minus').addClass('icon_plus');
			$(this).addClass('active').siblings().removeClass('active');
			$(this).next().slideDown()
				.end().find('.accordion_icon').removeClass('icon_plus').addClass('icon_minus');
		}
	});
}
// totop
function totop(){
	// totop position
	$('.totop').css({'right': Math.abs((($(window).width() - $('.container').width())/2)-88)});
	// show totop
	if (($(window).scrollTop()*3) > ($(window).height()))
		$('.totop').show();
	else
		$('.totop').hide();
	// sticky on footer
	if ($(window).scrollTop() >= ($('#main_footer_head').offset().top - $(window).height()))
		$('.totop').addClass('totop_absolute').stop(true,true).show();
	else
		$('.totop').removeClass('totop_absolute');
	// on scroll
	$(window).scroll(function(){
		// show totop
		if (($(window).scrollTop()*3) > ($(window).height()))
			$('.totop').slideDown();
		else
			$('.totop').slideUp();
		// sticky on footer on scroll
		if ($(window).scrollTop() >= ($('#main_footer_head').offset().top - $(window).height()))
			$('.totop').addClass('totop_absolute').stop(true,true).show();
		else
			$('.totop').removeClass('totop_absolute');
	});
	// on resize
	$(window).resize(function(){
		// totop position
		$('.totop').css({'right': Math.abs((($(window).width() - $('.container').width())/2)-88) });
	});
	// on click
	$('.totop').click(function(e){
		$("html, body").animate({scrollTop :0},500);
		return false;
	});
}
function playerInit(){
	if($.fn.mediaelementplayer){
		$('video,audio').mediaelementplayer({
			features:['playpause','progress','volume']
		});
	}
}
function tabs(ele,op){
	if($.fn.moozhlTabs && ele.length > 0){
		ele.moozhlTabs(op);
	}
}
function removeAlert(ele){
	ele.click(function(){
		$(this).parent().remove();
		return false;
	});
}	
function columns(ele,responsiveColumns){
	var eles = ele.find('article'),
		childrenCount = eles.length,
		columnsCount,
		columnClass,
		currObj,
		$window = $(window),
		windowSize = $window.outerWidth();
		console.log(windowSize);
	if(childrenCount > 1){
		for(counter=0;counter<responsiveColumns.length;counter++){
			loopObj = responsiveColumns[counter];
			if('lt' in loopObj && loopObj.lt > windowSize && 'gt' in loopObj && loopObj.gt < windowSize){
				console.log(windowSize + '' + loopObj.lt);
				currObj = loopObj;
			}else if('lt' in loopObj && loopObj.lt > windowSize && typeof loopObj.gt === 'undefined'){
				currObj = loopObj;
			}else if('gt' in loopObj && loopObj.gt < windowSize && typeof loopObj.lt === 'undefined'){
				currObj = loopObj;
			}else if(typeof loopObj.lt === 'undefined' && typeof loopObj.gt === 'undefined'){
				currObj = loopObj;
			}
		}
		columnClass = currObj.columnClass;
		columnsCount = currObj.columns;
		perColumnPlus = childrenCount%columnsCount;
		perColumn = (childrenCount - perColumnPlus) / columnsCount;
		for(counter1=1;counter1<=columnsCount;counter1++){
			ele.find('article').slice(perColumn*(counter1-1),perColumn*counter1).wrapAll('<div class="column '+ columnClass +'" />');
		}
		for(counter2=0;counter2<columnsCount;counter2++){
			ele.find('article').eq(childrenCount - perColumnPlus + counter2).appendTo(ele.find('.column:eq('+ (counter2) +')'));
		}
	}
}
function countDown(ele,op){
	if($.fn.countDown && ele.length > 0){
		ele.countDown(op);
	}
}
// usage
$(document).ready(function() {
	headerSearch();
	mainNav();
	// columns
	columns(
		$('.main_content_2_of_3 .columns'),
		[
			{columns:2,columnClass:'column_1_of_3'},
			{columns:3,columnClass:'column_1_of_4',lt:1015,gt:768},
			{columns:2,columnClass:'column_1_of_4',lt:767}
		]
	);
	columns(
		$('.main_content_3_of_3 .columns'),
		[
			{columns:3,columnClass:'column_1_of_3'},
			{columns:3,columnClass:'column_1_of_4',lt:1015,gt:768},
			{columns:2,columnClass:'column_1_of_4',lt:767}
		]
	);
	columns(
		$('.main_content_4_of_4 .columns'),
		[
			{columns:4,columnClass:'column_1_of_4'},
			{columns:3,columnClass:'column_1_of_4',lt:1015,gt:768},
			{columns:2,columnClass:'column_1_of_4',lt:767}
		]
	);
	// Sliders
	flexSliderUsage($('#main_slider'),mainSliderOptions);
	flexSliderUsage($('.works_carousel'),worksCarousel);
	flexSliderUsage($('.team_carousel'),teamCarousel);
	flexSliderUsage($('.feedback_slider'),feedbackSlider);
	flexSliderUsage($('.partners_slider'),partnersSlider);
	flexSliderUsage($('.portfolio_slider .thumbnails'),portfolioThumbnails);
	flexSliderUsage($('.portfolio_slider .slider'),portfolioSlider);
	flexSliderUsage($('.block_simple_slider .block_body'),simpleSlider);
	flexSliderUsage($('.post_gallery_head'),postGalleryHead);
	// 
	blockVisibility();
	accordion();
	totop();
	playerInit();
	tabs($('.widget_posts_tabs'));
	tabs($('.entry_tabs'));
	removeAlert($('.widget_alert_icon'));
	countDown($('#coming_countdown'),comingCounter);
});
$(window).load(function(){
	newsTicker();
});